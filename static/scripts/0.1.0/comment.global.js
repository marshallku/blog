"use strict";(()=>{function s(r,m){return{postSlug:r,apiUrl:m,name:localStorage.getItem("comment-name")||"",url:localStorage.getItem("comment-url")||"",body:"",parentId:"",replyingTo:"",loading:!1,async init(){await this.loadComments(),document.getElementById("comment-list")?.addEventListener("click",e=>{let t=e.target;t.matches(".comment-bubble__reply-btn")&&this.setReply(t.dataset.id||"",t.dataset.name||"")})},async loadComments(){let e=document.getElementById("comment-list");if(e)try{let t=await fetch(`${this.apiUrl}/api/v2/comment/list?postSlug=${encodeURIComponent(this.postSlug)}`);if(!t.ok)throw new Error;e.innerHTML=await t.text()}catch{e.innerHTML='<p class="comment-list__error">\uB313\uAE00\uC744 \uBD88\uB7EC\uC624\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4.</p>'}},setReply(e,t){this.parentId=e,this.replyingTo=t,document.getElementById("comment-body")?.focus()},cancelReply(){this.parentId="",this.replyingTo=""},async submit(){this.loading=!0,localStorage.setItem("comment-name",this.name),this.url&&localStorage.setItem("comment-url",this.url);try{let e=await fetch(`${this.apiUrl}/api/v2/comment/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postSlug:this.postSlug,name:this.name||"\uC775\uBA85",url:this.url||void 0,body:this.body,parentCommentId:this.parentId||void 0})});if(!e.ok)throw new Error;let t=await e.text();if(this.parentId){let i=document.getElementById("comment-"+this.parentId);if(!i)return;let n=i.nextElementSibling;(!n||n.tagName!=="UL")&&(n=document.createElement("ul"),i.after(n)),n.insertAdjacentHTML("beforeend",t)}else{let i=document.getElementById("comment-list");if(!i)return;let n=i.querySelector("ul.comment-list");if(n){let o=n.querySelector(".comment-list__empty");o&&o.remove(),n.insertAdjacentHTML("afterbegin",t)}else i.innerHTML='<ul class="comment-list">'+t+"</ul>"}this.body="",this.cancelReply()}catch{alert("\uB313\uAE00 \uB4F1\uB85D\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.")}finally{this.loading=!1}}}}window.commentForm=s;})();
