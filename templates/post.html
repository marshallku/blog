{% extends "base.html" %}
{% import "macros/post-card.html" as macros %}
{% import "macros/prev-next-post.html" as nav_macros %}

{% block title %}{{ post.frontmatter.title }} - {{ config.site_title }}{% endblock %}

{% block description %}{{ post.frontmatter.description | default(value="") }}{% endblock %}

{% block meta %}
    {{ super() }}

    <link rel="canonical" href="{{ config.site_url }}/{{ post.category }}/{{ post.slug }}/">

    <meta property="og:title" content="{{ post.frontmatter.title }}">
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ config.site_url }}/{{ post.category }}/{{ post.slug }}/">
    <meta property="og:site_name" content="{{ config.site_title }}">
    {% if post.frontmatter.description %}
    <meta property="og:description" content="{{ post.frontmatter.description }}">
    {% endif %}
    {% if post.frontmatter.cover_image %}
    <meta property="og:image" content="{{ config.site_url }}{{ post.frontmatter.cover_image }}">
    {% endif %}
    <meta property="article:published_time" content="{{ post.frontmatter.date.posted }}">
    {% if post.frontmatter.date.modified %}
    <meta property="article:modified_time" content="{{ post.frontmatter.date.modified }}">
    {% endif %}
    <meta property="article:author" content="{{ config.author }}">
    <meta property="article:section" content="{{ post.category }}">
    {% for tag in post.frontmatter.tags %}
    <meta property="article:tag" content="{{ tag }}">
    {% endfor %}

    <meta name="twitter:card" content="{% if post.frontmatter.cover_image %}summary_large_image{% else %}summary{% endif %}">
    <meta name="twitter:title" content="{{ post.frontmatter.title }}">
    {% if post.frontmatter.description %}
    <meta name="twitter:description" content="{{ post.frontmatter.description }}">
    {% endif %}
    {% if post.frontmatter.cover_image %}
    <meta name="twitter:image" content="{{ config.site_url }}{{ post.frontmatter.cover_image }}">
    {% endif %}

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "{{ post.frontmatter.title }}",
        "url": "{{ config.site_url }}/{{ post.category }}/{{ post.slug }}/",
        "datePublished": "{{ post.frontmatter.date.posted }}",
        {% if post.frontmatter.date.modified %}
        "dateModified": "{{ post.frontmatter.date.modified }}",
        {% else %}
        "dateModified": "{{ post.frontmatter.date.posted }}",
        {% endif %}
        {% if post.frontmatter.description %}
        "description": "{{ post.frontmatter.description }}",
        {% endif %}
        {% if post.frontmatter.cover_image %}
        "image": "{{ config.site_url }}{{ post.frontmatter.cover_image }}",
        {% endif %}
        "author": {
            "@type": "Person",
            "name": "{{ config.author }}"
        },
        "publisher": {
            "@type": "Organization",
            "name": "{{ config.site_title }}",
            "url": "{{ config.site_url }}"
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "{{ config.site_url }}/{{ post.category }}/{{ post.slug }}/"
        }
    }
    </script>
{% endblock %}

{% block content %}
<article class="post">
    <header class="post-header {% if post.frontmatter.cover_image %}post-header--has-cover{% endif %}">
        {% if post.frontmatter.tags %}
        <div class="post-header__tags">
            {% for tag in post.frontmatter.tags %}
            <a href="/tag/{{ tag }}/" class="typography-c1"># {{ tag | urldecode }}</a>
            {% endfor %}
        </div>
        {% endif %}
        <h1 class="post-header__title typography-h1">{{ post.frontmatter.title }}</h1>
        <div class="post-header__meta typography-c1">
            <span class="post-header__category">
                <a href="/{{ post.category }}/">{{ category_info.name | default(value=post.category) }}</a>
            </span>
            <span> • </span>
            <time datetime="{{ post.frontmatter.date.posted }}" class="post-header__date">
                {{ post.frontmatter.date.posted | date(format="%Y년 %m월 %d일") }}
            </time>
        </div>
    </header>
    
    {% if post.frontmatter.cover_image %}
    <figure class="post__cover">
        <img src="{{ post.frontmatter.cover_image }}" alt="{{ post.frontmatter.title }}" class="featured-image">
    </figure>
    {% endif %}

    {% if post.frontmatter.date.modified %}
    <div class="post__meta typography-c1">
        <time datetime="{{ post.frontmatter.date.modified }}">
            최종 수정일: {{ post.frontmatter.date.modified | date(format="%Y년 %m월 %d일") }}
        </time>
    </div>
    {% endif %}

    <div class="post__body typography-b1">
        {{ content | safe }}
    </div>
</article>

{# Previous/Next Post Navigation #}
{{ nav_macros::prev_next_post(prev=prev_post, next=next_post) }}

{% if related_posts and related_posts | length > 0 %}
<section class="post-related-posts">
    <h2 class="post-related-posts__title typography-h3">
        <a href="/{{ post.category }}/">{{ category_info.name | default(value=post.category) }} 카테고리</a> 관련 글
    </h2>
    <p class="post-related-posts__text typography-b1">
        위 글이 유용하셨다면, 아래 글도 읽어보세요!
    </p>
    <div class="post-related-posts__posts post-grid">
        {% for related in related_posts %}
        {{ macros::post_card(post=related) }}
        {% endfor %}
    </div>
</section>
{% endif %}

{% block comments %}
{% endblock %}
{% endblock %}
